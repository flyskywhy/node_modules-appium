'use strict';

var _interopRequireDefault = require('babel-runtime/helpers/interop-require-default')['default'];

var _libBasedriverCapabilities = require('../../lib/basedriver/capabilities');

var _chai = require('chai');

var _chai2 = _interopRequireDefault(_chai);

var _chaiAsPromised = require('chai-as-promised');

var _chaiAsPromised2 = _interopRequireDefault(_chaiAsPromised);

_chai2['default'].use(_chaiAsPromised2['default']);

describe('caps', function () {

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-validate-caps
  describe('#validateCaps', function () {
    it('returns invalid argument error if "capability" is not a JSON object (1)', function () {
      var _arr = [undefined, null, 1, true, 'string'];

      var _loop = function () {
        var arg = _arr[_i];
        (function () {
          (0, _libBasedriverCapabilities.validateCaps)(arg);
        }).should['throw'](/must be a JSON object/);
      };

      for (var _i = 0; _i < _arr.length; _i++) {
        _loop();
      }
    });

    it('returns result {} by default if caps is empty object and no constraints provided (2)', function () {
      (0, _libBasedriverCapabilities.validateCaps)({}).should.deep.equal({});
    });

    describe('throws errors if constraints are not met', function () {
      it('returns invalid argument error if "present" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({}, { foo: { presence: true } });
        }).should['throw'](/foo can't be blank/);
      });

      it('returns the capability that was passed in if "skipPresenceConstraint" is false', function () {
        (0, _libBasedriverCapabilities.validateCaps)({}, { foo: { presence: true } }, true).should.deep.equal({});
      });

      it('returns invalid argument error if "isString" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 1 }, { foo: { isString: true } });
        }).should['throw'](/foo must be of type string/);
      });

      it('returns invalid argument error if "isNumber" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'bar' }, { foo: { isNumber: true } });
        }).should['throw'](/foo must be of type number/);
      });

      it('returns invalid argument error if "isBoolean" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'bar' }, { foo: { isBoolean: true } });
        }).should['throw'](/foo must be of type boolean/);
      });

      it('returns invalid argument error if "inclusion" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: '3' }, { foo: { inclusionCaseInsensitive: ['1', '2'] } });
        }).should['throw'](/foo 3 not part of 1,2./);
      });

      it('returns invalid argument error if "inclusionCaseInsensitive" constraint not met on property', function () {
        (function () {
          return (0, _libBasedriverCapabilities.validateCaps)({ foo: 'a' }, { foo: { inclusion: ['A', 'B', 'C'] } });
        }).should['throw'](/foo a is not included in the list/);
      });
    });

    it('should not throw errors if constraints are met', function () {
      var caps = {
        number: 1,
        string: 'string',
        present: 'present',
        extra: 'extra'
      };

      var constraints = {
        number: { isNumber: true },
        string: { isString: true },
        present: { presence: true },
        notPresent: { presence: false }
      };

      (0, _libBasedriverCapabilities.validateCaps)(caps, constraints).should.deep.equal(caps);
    });
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-merging-caps
  describe('#mergeCaps', function () {
    it('returns a result that is {} by default (1)', function () {
      (0, _libBasedriverCapabilities.mergeCaps)().should.deep.equal({});
    });

    it('returns a result that matches primary by default (2, 3)', function () {
      (0, _libBasedriverCapabilities.mergeCaps)({ hello: 'world' }).should.deep.equal({ hello: 'world' });
    });

    it('returns invalid argument error if primary and secondary have matching properties (4)', function () {
      (function () {
        return (0, _libBasedriverCapabilities.mergeCaps)({ hello: 'world' }, { hello: 'whirl' });
      }).should['throw'](/property hello should not exist on both primary and secondary/);
    });

    it('returns a result with keys from primary and secondary together', function () {
      var primary = {
        a: 'a',
        b: 'b'
      };
      var secondary = {
        c: 'c',
        d: 'd'
      };
      (0, _libBasedriverCapabilities.mergeCaps)(primary, secondary).should.deep.equal({
        a: 'a', b: 'b', c: 'c', d: 'd'
      });
    });
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#dfn-matching-caps
  describe('#matchCaps', function () {
    // TODO: Do we need this?
  });

  // Tests based on: https://www.w3.org/TR/webdriver/#processing-caps
  describe('#parseCaps', function () {
    var caps = undefined;

    beforeEach(function () {
      caps = {};
    });

    it('should return invalid argument if no caps object provided', function () {
      (function () {
        return (0, _libBasedriverCapabilities.parseCaps)();
      }).should['throw'](/must be a JSON object/);
    });

    it('sets "requiredCaps" to property named "alwaysMatch" (2)', function () {
      caps.alwaysMatch = { hello: 'world' };
      (0, _libBasedriverCapabilities.parseCaps)(caps).requiredCaps.should.deep.equal(caps.alwaysMatch);
    });

    it('sets "requiredCaps" to empty JSON object if "alwaysMatch" is not an object (2.1)', function () {
      (0, _libBasedriverCapabilities.parseCaps)(caps).requiredCaps.should.deep.equal({});
    });

    it('returns invalid argument error if "requiredCaps" don\'t match "constraints" (2.2)', function () {
      caps.alwaysMatch = { foo: 1 };
      (function () {
        return (0, _libBasedriverCapabilities.parseCaps)(caps, { foo: { isString: true } });
      }).should['throw'](/foo must be of type string/);
    });

    it('sets "allFirstMatchCaps" to property named "firstMatch" (3)', function () {
      (0, _libBasedriverCapabilities.parseCaps)({}, []).allFirstMatchCaps.should.deep.equal([]);
    });

    it('sets "allFirstMatchCaps" to [] if "firstMatch" is undefined (3.1)', function () {
      (0, _libBasedriverCapabilities.parseCaps)({}).allFirstMatchCaps.should.deep.equal([]);
    });

    it('returns invalid argument error if "firstMatch" is not an array and is not undefined (3.2)', function () {
      var _arr2 = [null, 1, true, 'string'];

      for (var _i2 = 0; _i2 < _arr2.length; _i2++) {
        var arg = _arr2[_i2];
        caps.firstMatch = arg;
        (function () {
          (0, _libBasedriverCapabilities.parseCaps)(caps);
        }).should['throw'](/must be a JSON array or undefined/);
      }
    });

    it('has "validatedFirstMatchCaps" property that is [] by default (4)', function () {
      (0, _libBasedriverCapabilities.parseCaps)(caps).validatedFirstMatchCaps.should.deep.equal([]);
    });

    describe('returns a "validatedFirstMatchCaps" array (5)', function () {
      it('that equals "firstMatch" if firstMatch is one empty object and there are no constraints', function () {
        caps.firstMatch = [{}];
        (0, _libBasedriverCapabilities.parseCaps)(caps).validatedFirstMatchCaps.should.deep.equal(caps.firstMatch);
      });

      it('returns invalid argument error if firstMatch array\'s first argument fails constraints', function () {
        caps.firstMatch = [{}];
        (function () {
          return (0, _libBasedriverCapabilities.parseCaps)(caps, { foo: { presence: true } });
        }).should['throw'](/foo can't be blank/);
      });

      it('that equals firstMatch if firstMatch contains two objects that pass the provided constraints', function () {
        caps.alwaysMatch = {
          foo: 'bar'
        };
        caps.firstMatch = [{ foo: 'bar1' }, { foo: 'bar2' }];

        var constraints = {
          foo: {
            presence: true,
            isString: true
          }
        };

        (0, _libBasedriverCapabilities.parseCaps)(caps, constraints).validatedFirstMatchCaps.should.deep.equal(caps.firstMatch);
      });

      it('returns invalid argument error if the firstMatch[2] is not an object', function () {
        caps.firstMatch = [{ foo: 'bar' }, 'foo'];
        (function () {
          return (0, _libBasedriverCapabilities.parseCaps)(caps, {});
        }).should['throw'](/must be a JSON object/);
      });
    });

    describe('returns a matchedCaps object (6)', function () {
      beforeEach(function () {
        caps.alwaysMatch = { hello: 'world' };
      });

      it('which is same as alwaysMatch if firstMatch array is not provided', function () {
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world' });
      });

      it('merges caps together', function () {
        caps.firstMatch = [{ foo: 'bar' }];
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world', foo: 'bar' });
      });

      it('with merged caps', function () {
        caps.firstMatch = [{ hello: 'bar', foo: 'foo' }, { foo: 'bar' }];
        (0, _libBasedriverCapabilities.parseCaps)(caps).matchedCaps.should.deep.equal({ hello: 'world', foo: 'bar' });
      });
    });
  });

  describe('#processCaps', function () {
    it('should return "alwaysMatch" if "firstMatch" and "constraints" were not provided', function () {
      (0, _libBasedriverCapabilities.processCaps)({}).should.deep.equal({});
    });

    it('should return merged caps', function () {
      (0, _libBasedriverCapabilities.processCaps)({
        alwaysMatch: { hello: 'world' },
        firstMatch: [{ foo: 'bar' }]
      }).should.deep.equal({ hello: 'world', foo: 'bar' });
    });
  });
});
//# sourceMappingURL=data:application/json;charset=utf8;base64,eyJ2ZXJzaW9uIjozLCJzb3VyY2VzIjpbInRlc3QvYmFzZWRyaXZlci9jYXBhYmlsaXRpZXMtc3BlY3MuanMiXSwibmFtZXMiOltdLCJtYXBwaW5ncyI6Ijs7Ozt5Q0FBZ0UsbUNBQW1DOztvQkFDbEYsTUFBTTs7Ozs4QkFDSSxrQkFBa0I7Ozs7QUFFN0Msa0JBQUssR0FBRyw2QkFBZ0IsQ0FBQzs7QUFFekIsUUFBUSxDQUFDLE1BQU0sRUFBRSxZQUFNOzs7QUFHckIsVUFBUSxDQUFDLGVBQWUsRUFBRSxZQUFNO0FBQzlCLE1BQUUsQ0FBQyx5RUFBeUUsRUFBRSxZQUFNO2lCQUNsRSxDQUFDLFNBQVMsRUFBRSxJQUFJLEVBQUUsQ0FBQyxFQUFFLElBQUksRUFBRSxRQUFRLENBQUM7OztBQUEvQyxZQUFJLEdBQUcsV0FBQSxDQUFBO0FBQ1YsU0FBQyxZQUFZO0FBQUUsdURBQWEsR0FBRyxDQUFDLENBQUM7U0FBRSxDQUFBLENBQUUsTUFBTSxTQUFNLENBQUMsdUJBQXVCLENBQUMsQ0FBQzs7O0FBRDdFLCtDQUFzRDs7T0FFckQ7S0FDRixDQUFDLENBQUM7O0FBRUgsTUFBRSxDQUFDLHNGQUFzRixFQUFFLFlBQU07QUFDL0YsbURBQWEsRUFBRSxDQUFDLENBQUMsTUFBTSxDQUFDLElBQUksQ0FBQyxLQUFLLENBQUMsRUFBRSxDQUFDLENBQUM7S0FDeEMsQ0FBQyxDQUFDOztBQUVILFlBQVEsQ0FBQywwQ0FBMEMsRUFBRSxZQUFNO0FBQ3pELFFBQUUsQ0FBQyw0RUFBNEUsRUFBRSxZQUFNO0FBQ3JGLFNBQUM7aUJBQU0sNkNBQWEsRUFBRSxFQUFFLEVBQUMsR0FBRyxFQUFFLEVBQUMsUUFBUSxFQUFFLElBQUksRUFBQyxFQUFDLENBQUM7VUFBQSxDQUFFLE1BQU0sU0FBTSxDQUFDLG9CQUFvQixDQUFDLENBQUM7T0FDdEYsQ0FBQyxDQUFDOztBQUVILFFBQUUsQ0FBQyxnRkFBZ0YsRUFBRSxZQUFNO0FBQ3pGLHFEQUFhLEVBQUUsRUFBRSxFQUFDLEdBQUcsRUFBRSxFQUFDLFFBQVEsRUFBRSxJQUFJLEVB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ZXIvY2FwYWJpbGl0aWVzLXNwZWNzLmpzIiwic291cmNlc0NvbnRlbnQiOlsiaW1wb3J0IHsgcGFyc2VDYXBzLCB2YWxpZGF0ZUNhcHMsIG1lcmdlQ2FwcywgcHJvY2Vzc0NhcHMgfSBmcm9tICcuLi8uLi9saWIvYmFzZWRyaXZlci9jYXBhYmlsaXRpZXMnO1xuaW1wb3J0IGNoYWkgZnJvbSAnY2hhaSc7XG5pbXBvcnQgY2hhaUFzUHJvbWlzZWQgZnJvbSAnY2hhaS1hcy1wcm9taXNlZCc7XG5cbmNoYWkudXNlKGNoYWlBc1Byb21pc2VkKTtcblxuZGVzY3JpYmUoJ2NhcHMnLCAoKSA9PiB7XG5cbiAgLy8gVGVzdHMgYmFzZWQgb246IGh0dHBzOi8vd3d3LnczLm9yZy9UUi93ZWJkcml2ZXIvI2Rmbi12YWxpZGF0ZS1jYXBzXG4gIGRlc2NyaWJlKCcjdmFsaWRhdGVDYXBzJywgKCkgPT4ge1xuICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJjYXBhYmlsaXR5XCIgaXMgbm90IGEgSlNPTiBvYmplY3QgKDEpJywgKCkgPT4ge1xuICAgICAgZm9yIChsZXQgYXJnIG9mIFt1bmRlZmluZWQsIG51bGwsIDEsIHRydWUsICdzdHJpbmcnXSkge1xuICAgICAgICAoZnVuY3Rpb24gKCkgeyB2YWxpZGF0ZUNhcHMoYXJnKTsgfSkuc2hvdWxkLnRocm93KC9tdXN0IGJlIGEgSlNPTiBvYmplY3QvKTtcbiAgICAgIH1cbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIHJlc3VsdCB7fSBieSBkZWZhdWx0IGlmIGNhcHMgaXMgZW1wdHkgb2JqZWN0IGFuZCBubyBjb25zdHJhaW50cyBwcm92aWRlZCAoMiknLCAoKSA9PiB7XG4gICAgICB2YWxpZGF0ZUNhcHMoe30pLnNob3VsZC5kZWVwLmVxdWFsKHt9KTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCd0aHJvd3MgZXJyb3JzIGlmIGNvbnN0cmFpbnRzIGFyZSBub3QgbWV0JywgKCkgPT4ge1xuICAgICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBcInByZXNlbnRcIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCAoKSA9PiB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe30sIHtmb286IHtwcmVzZW5jZTogdHJ1ZX19KSkuc2hvdWxkLnRocm93KC9mb28gY2FuJ3QgYmUgYmxhbmsvKTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyB0aGUgY2FwYWJpbGl0eSB0aGF0IHdhcyBwYXNzZWQgaW4gaWYgXCJza2lwUHJlc2VuY2VDb25zdHJhaW50XCIgaXMgZmFsc2UnLCAoKSA9PiB7XG4gICAgICAgIHZhbGlkYXRlQ2Fwcyh7fSwge2Zvbzoge3ByZXNlbmNlOiB0cnVlfX0sIHRydWUpLnNob3VsZC5kZWVwLmVxdWFsKHt9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwiaXNTdHJpbmdcIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCAoKSA9PiB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe2ZvbzogMX0sIHtmb286IHtpc1N0cmluZzogdHJ1ZX19KSkuc2hvdWxkLnRocm93KC9mb28gbXVzdCBiZSBvZiB0eXBlIHN0cmluZy8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJpc051bWJlclwiIGNvbnN0cmFpbnQgbm90IG1ldCBvbiBwcm9wZXJ0eScsICgpID0+IHtcbiAgICAgICAgKCgpID0+IHZhbGlkYXRlQ2Fwcyh7Zm9vOiAnYmFyJ30sIHtmb286IHtpc051bWJlcjogdHJ1ZX19KSkuc2hvdWxkLnRocm93KC9mb28gbXVzdCBiZSBvZiB0eXBlIG51bWJlci8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJpc0Jvb2xlYW5cIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCAoKSA9PiB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe2ZvbzogJ2Jhcid9LCB7Zm9vOiB7aXNCb29sZWFuOiB0cnVlfX0pKS5zaG91bGQudGhyb3coL2ZvbyBtdXN0IGJlIG9mIHR5cGUgYm9vbGVhbi8pO1xuICAgICAgfSk7XG5cbiAgICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJpbmNsdXNpb25cIiBjb25zdHJhaW50IG5vdCBtZXQgb24gcHJvcGVydHknLCAoKSA9PiB7XG4gICAgICAgICgoKSA9PiB2YWxpZGF0ZUNhcHMoe2ZvbzogJzMnfSwge2Zvbzoge2luY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZTogWycxJywgJzInXX19KSkuc2hvdWxkLnRocm93KC9mb28gMyBub3QgcGFydCBvZiAxLDIuLyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBcImluY2x1c2lvbkNhc2VJbnNlbnNpdGl2ZVwiIGNvbnN0cmFpbnQgbm90IG1ldCBvbiBwcm9wZXJ0eScsICgpID0+IHtcbiAgICAgICAgKCgpID0+IHZhbGlkYXRlQ2Fwcyh7Zm9vOiAnYSd9LCB7Zm9vOiB7aW5jbHVzaW9uOiBbJ0EnLCAnQicsICdDJ119fSkpLnNob3VsZC50aHJvdygvZm9vIGEgaXMgbm90IGluY2x1ZGVkIGluIHRoZSBsaXN0Lyk7XG4gICAgICB9KTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgbm90IHRocm93IGVycm9ycyBpZiBjb25zdHJhaW50cyBhcmUgbWV0JywgKCkgPT4ge1xuICAgICAgbGV0IGNhcHMgPSB7XG4gICAgICAgIG51bWJlcjogMSxcbiAgICAgICAgc3RyaW5nOiAnc3RyaW5nJyxcbiAgICAgICAgcHJlc2VudDogJ3ByZXNlbnQnLFxuICAgICAgICBleHRyYTogJ2V4dHJhJyxcbiAgICAgIH07XG5cbiAgICAgIGxldCBjb25zdHJhaW50cyA9IHtcbiAgICAgICAgbnVtYmVyOiB7aXNOdW1iZXI6IHRydWV9LFxuICAgICAgICBzdHJpbmc6IHtpc1N0cmluZzogdHJ1ZX0sXG4gICAgICAgIHByZXNlbnQ6IHtwcmVzZW5jZTogdHJ1ZX0sXG4gICAgICAgIG5vdFByZXNlbnQ6IHtwcmVzZW5jZTogZmFsc2V9LFxuICAgICAgfTtcblxuICAgICAgdmFsaWRhdGVDYXBzKGNhcHMsIGNvbnN0cmFpbnRzKS5zaG91bGQuZGVlcC5lcXVhbChjYXBzKTtcbiAgICB9KTtcbiAgfSk7XG5cbiAgLy8gVGVzdHMgYmFzZWQgb246IGh0dHBzOi8vd3d3LnczLm9yZy9UUi93ZWJkcml2ZXIvI2Rmbi1tZXJnaW5nLWNhcHNcbiAgZGVzY3JpYmUoJyNtZXJnZUNhcHMnLCAoKSA9PiB7XG4gICAgaXQoJ3JldHVybnMgYSByZXN1bHQgdGhhdCBpcyB7fSBieSBkZWZhdWx0ICgxKScsICgpID0+IHtcbiAgICAgIG1lcmdlQ2FwcygpLnNob3VsZC5kZWVwLmVxdWFsKHt9KTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGEgcmVzdWx0IHRoYXQgbWF0Y2hlcyBwcmltYXJ5IGJ5IGRlZmF1bHQgKDIsIDMpJywgKCkgPT4ge1xuICAgICAgbWVyZ2VDYXBzKHtoZWxsbzogJ3dvcmxkJ30pLnNob3VsZC5kZWVwLmVxdWFsKHtoZWxsbzogJ3dvcmxkJ30pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBwcmltYXJ5IGFuZCBzZWNvbmRhcnkgaGF2ZSBtYXRjaGluZyBwcm9wZXJ0aWVzICg0KScsICgpID0+IHtcbiAgICAgICgoKSA9PiBtZXJnZUNhcHMoe2hlbGxvOiAnd29ybGQnfSwge2hlbGxvOiAnd2hpcmwnfSkpLnNob3VsZC50aHJvdygvcHJvcGVydHkgaGVsbG8gc2hvdWxkIG5vdCBleGlzdCBvbiBib3RoIHByaW1hcnkgYW5kIHNlY29uZGFyeS8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3JldHVybnMgYSByZXN1bHQgd2l0aCBrZXlzIGZyb20gcHJpbWFyeSBhbmQgc2Vjb25kYXJ5IHRvZ2V0aGVyJywgKCkgPT4ge1xuICAgICAgbGV0IHByaW1hcnkgPSB7XG4gICAgICAgIGE6ICdhJyxcbiAgICAgICAgYjogJ2InLFxuICAgICAgfTtcbiAgICAgIGxldCBzZWNvbmRhcnkgPSB7XG4gICAgICAgIGM6ICdjJyxcbiAgICAgICAgZDogJ2QnLFxuICAgICAgfTtcbiAgICAgIG1lcmdlQ2FwcyhwcmltYXJ5LCBzZWNvbmRhcnkpLnNob3VsZC5kZWVwLmVxdWFsKHtcbiAgICAgICAgYTogJ2EnLCBiOiAnYicsIGM6ICdjJywgZDogJ2QnLFxuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIC8vIFRlc3RzIGJhc2VkIG9uOiBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNkZm4tbWF0Y2hpbmctY2Fwc1xuICBkZXNjcmliZSgnI21hdGNoQ2FwcycsICgpID0+IHtcbiAgICAvLyBUT0RPOiBEbyB3ZSBuZWVkIHRoaXM/XG4gIH0pO1xuXG4gIC8vIFRlc3RzIGJhc2VkIG9uOiBodHRwczovL3d3dy53My5vcmcvVFIvd2ViZHJpdmVyLyNwcm9jZXNzaW5nLWNhcHNcbiAgZGVzY3JpYmUoJyNwYXJzZUNhcHMnLCAoKSA9PiB7XG4gICAgbGV0IGNhcHM7XG5cbiAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgIGNhcHMgPSB7fTtcbiAgICB9KTtcblxuICAgIGl0KCdzaG91bGQgcmV0dXJuIGludmFsaWQgYXJndW1lbnQgaWYgbm8gY2FwcyBvYmplY3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICAoKCkgPT4gcGFyc2VDYXBzKCkpLnNob3VsZC50aHJvdygvbXVzdCBiZSBhIEpTT04gb2JqZWN0Lyk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2V0cyBcInJlcXVpcmVkQ2Fwc1wiIHRvIHByb3BlcnR5IG5hbWVkIFwiYWx3YXlzTWF0Y2hcIiAoMiknLCAoKSA9PiB7XG4gICAgICBjYXBzLmFsd2F5c01hdGNoID0ge2hlbGxvOiAnd29ybGQnfTtcbiAgICAgIHBhcnNlQ2FwcyhjYXBzKS5yZXF1aXJlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoY2Fwcy5hbHdheXNNYXRjaCk7XG4gICAgfSk7XG5cbiAgICBpdCgnc2V0cyBcInJlcXVpcmVkQ2Fwc1wiIHRvIGVtcHR5IEpTT04gb2JqZWN0IGlmIFwiYWx3YXlzTWF0Y2hcIiBpcyBub3QgYW4gb2JqZWN0ICgyLjEpJywgKCkgPT4ge1xuICAgICAgcGFyc2VDYXBzKGNhcHMpLnJlcXVpcmVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbCh7fSk7XG4gICAgfSk7XG5cbiAgICBpdCgncmV0dXJucyBpbnZhbGlkIGFyZ3VtZW50IGVycm9yIGlmIFwicmVxdWlyZWRDYXBzXCIgZG9uXFwndCBtYXRjaCBcImNvbnN0cmFpbnRzXCIgKDIuMiknLCAoKSA9PiB7XG4gICAgICBjYXBzLmFsd2F5c01hdGNoID0ge2ZvbzogMX07XG4gICAgICAoKCkgPT4gcGFyc2VDYXBzKGNhcHMsIHtmb286IHtpc1N0cmluZzogdHJ1ZX19KSkuc2hvdWxkLnRocm93KC9mb28gbXVzdCBiZSBvZiB0eXBlIHN0cmluZy8pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3NldHMgXCJhbGxGaXJzdE1hdGNoQ2Fwc1wiIHRvIHByb3BlcnR5IG5hbWVkIFwiZmlyc3RNYXRjaFwiICgzKScsICgpID0+IHtcbiAgICAgIHBhcnNlQ2Fwcyh7fSwgW10pLmFsbEZpcnN0TWF0Y2hDYXBzLnNob3VsZC5kZWVwLmVxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGl0KCdzZXRzIFwiYWxsRmlyc3RNYXRjaENhcHNcIiB0byBbXSBpZiBcImZpcnN0TWF0Y2hcIiBpcyB1bmRlZmluZWQgKDMuMSknLCAoKSA9PiB7XG4gICAgICBwYXJzZUNhcHMoe30pLmFsbEZpcnN0TWF0Y2hDYXBzLnNob3VsZC5kZWVwLmVxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGl0KCdyZXR1cm5zIGludmFsaWQgYXJndW1lbnQgZXJyb3IgaWYgXCJmaXJzdE1hdGNoXCIgaXMgbm90IGFuIGFycmF5IGFuZCBpcyBub3QgdW5kZWZpbmVkICgzLjIpJywgKCkgPT4ge1xuICAgICAgZm9yIChsZXQgYXJnIG9mIFtudWxsLCAxLCB0cnVlLCAnc3RyaW5nJ10pIHtcbiAgICAgICAgY2Fwcy5maXJzdE1hdGNoID0gYXJnO1xuICAgICAgICAoZnVuY3Rpb24gKCkgeyBwYXJzZUNhcHMoY2Fwcyk7IH0pLnNob3VsZC50aHJvdygvbXVzdCBiZSBhIEpTT04gYXJyYXkgb3IgdW5kZWZpbmVkLyk7XG4gICAgICB9XG4gICAgfSk7XG5cbiAgICBpdCgnaGFzIFwidmFsaWRhdGVkRmlyc3RNYXRjaENhcHNcIiBwcm9wZXJ0eSB0aGF0IGlzIFtdIGJ5IGRlZmF1bHQgKDQpJywgKCkgPT4ge1xuICAgICAgcGFyc2VDYXBzKGNhcHMpLnZhbGlkYXRlZEZpcnN0TWF0Y2hDYXBzLnNob3VsZC5kZWVwLmVxdWFsKFtdKTtcbiAgICB9KTtcblxuICAgIGRlc2NyaWJlKCdyZXR1cm5zIGEgXCJ2YWxpZGF0ZWRGaXJzdE1hdGNoQ2Fwc1wiIGFycmF5ICg1KScsICgpID0+IHtcbiAgICAgIGl0KCd0aGF0IGVxdWFscyBcImZpcnN0TWF0Y2hcIiBpZiBmaXJzdE1hdGNoIGlzIG9uZSBlbXB0eSBvYmplY3QgYW5kIHRoZXJlIGFyZSBubyBjb25zdHJhaW50cycsICgpID0+IHtcbiAgICAgICAgY2Fwcy5maXJzdE1hdGNoID0gW3t9XTtcbiAgICAgICAgcGFyc2VDYXBzKGNhcHMpLnZhbGlkYXRlZEZpcnN0TWF0Y2hDYXBzLnNob3VsZC5kZWVwLmVxdWFsKGNhcHMuZmlyc3RNYXRjaCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiBmaXJzdE1hdGNoIGFycmF5XFwncyBmaXJzdCBhcmd1bWVudCBmYWlscyBjb25zdHJhaW50cycsICgpID0+IHtcbiAgICAgICAgY2Fwcy5maXJzdE1hdGNoID0gW3t9XTtcbiAgICAgICAgKCgpID0+IHBhcnNlQ2FwcyhjYXBzLCB7Zm9vOiB7cHJlc2VuY2U6IHRydWV9fSkpLnNob3VsZC50aHJvdygvZm9vIGNhbid0IGJlIGJsYW5rLyk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3RoYXQgZXF1YWxzIGZpcnN0TWF0Y2ggaWYgZmlyc3RNYXRjaCBjb250YWlucyB0d28gb2JqZWN0cyB0aGF0IHBhc3MgdGhlIHByb3ZpZGVkIGNvbnN0cmFpbnRzJywgKCkgPT4ge1xuICAgICAgICBjYXBzLmFsd2F5c01hdGNoID0ge1xuICAgICAgICAgIGZvbzogJ2JhcidcbiAgICAgICAgfTtcbiAgICAgICAgY2Fwcy5maXJzdE1hdGNoID0gW1xuICAgICAgICAgIHtmb286ICdiYXIxJ30sXG4gICAgICAgICAge2ZvbzogJ2JhcjInfSxcbiAgICAgICAgXTtcblxuICAgICAgICBsZXQgY29uc3RyYWludHMgPSB7XG4gICAgICAgICAgZm9vOiB7XG4gICAgICAgICAgICBwcmVzZW5jZTogdHJ1ZSxcbiAgICAgICAgICAgIGlzU3RyaW5nOiB0cnVlLFxuICAgICAgICAgIH1cbiAgICAgICAgfTtcblxuICAgICAgICBwYXJzZUNhcHMoY2FwcywgY29uc3RyYWludHMpLnZhbGlkYXRlZEZpcnN0TWF0Y2hDYXBzLnNob3VsZC5kZWVwLmVxdWFsKGNhcHMuZmlyc3RNYXRjaCk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3JldHVybnMgaW52YWxpZCBhcmd1bWVudCBlcnJvciBpZiB0aGUgZmlyc3RNYXRjaFsyXSBpcyBub3QgYW4gb2JqZWN0JywgKCkgPT4ge1xuICAgICAgICBjYXBzLmZpcnN0TWF0Y2ggPSBbe2ZvbzogJ2Jhcid9LCAnZm9vJ107XG4gICAgICAgICgoKSA9PiBwYXJzZUNhcHMoY2Fwcywge30pKS5zaG91bGQudGhyb3coL211c3QgYmUgYSBKU09OIG9iamVjdC8pO1xuICAgICAgfSk7XG4gICAgfSk7XG5cbiAgICBkZXNjcmliZSgncmV0dXJucyBhIG1hdGNoZWRDYXBzIG9iamVjdCAoNiknLCAoKSA9PiB7XG4gICAgICBiZWZvcmVFYWNoKCgpID0+IHtcbiAgICAgICAgY2Fwcy5hbHdheXNNYXRjaCA9IHtoZWxsbzogJ3dvcmxkJ307XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3doaWNoIGlzIHNhbWUgYXMgYWx3YXlzTWF0Y2ggaWYgZmlyc3RNYXRjaCBhcnJheSBpcyBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICAgIHBhcnNlQ2FwcyhjYXBzKS5tYXRjaGVkQ2Fwcy5zaG91bGQuZGVlcC5lcXVhbCh7aGVsbG86ICd3b3JsZCd9KTtcbiAgICAgIH0pO1xuXG4gICAgICBpdCgnbWVyZ2VzIGNhcHMgdG9nZXRoZXInLCAoKSA9PiB7XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IFt7Zm9vOiAnYmFyJ31dO1xuICAgICAgICBwYXJzZUNhcHMoY2FwcykubWF0Y2hlZENhcHMuc2hvdWxkLmRlZXAuZXF1YWwoe2hlbGxvOiAnd29ybGQnLCBmb286ICdiYXInfSk7XG4gICAgICB9KTtcblxuICAgICAgaXQoJ3dpdGggbWVyZ2VkIGNhcHMnLCAoKSA9PiB7XG4gICAgICAgIGNhcHMuZmlyc3RNYXRjaCA9IFt7aGVsbG86ICdiYXInLCBmb286ICdmb28nfSwge2ZvbzogJ2Jhcid9XTtcbiAgICAgICAgcGFyc2VDYXBzKGNhcHMpLm1hdGNoZWRDYXBzLnNob3VsZC5kZWVwLmVxdWFsKHtoZWxsbzogJ3dvcmxkJywgZm9vOiAnYmFyJ30pO1xuICAgICAgfSk7XG4gICAgfSk7XG4gIH0pO1xuXG4gIGRlc2NyaWJlKCcjcHJvY2Vzc0NhcHMnLCAoKSA9PiB7XG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gXCJhbHdheXNNYXRjaFwiIGlmIFwiZmlyc3RNYXRjaFwiIGFuZCBcImNvbnN0cmFpbnRzXCIgd2VyZSBub3QgcHJvdmlkZWQnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzQ2Fwcyh7fSkuc2hvdWxkLmRlZXAuZXF1YWwoe30pO1xuICAgIH0pO1xuXG4gICAgaXQoJ3Nob3VsZCByZXR1cm4gbWVyZ2VkIGNhcHMnLCAoKSA9PiB7XG4gICAgICBwcm9jZXNzQ2Fwcyh7XG4gICAgICAgIGFsd2F5c01hdGNoOiB7aGVsbG86ICd3b3JsZCd9LFxuICAgICAgICBmaXJzdE1hdGNoOiBbe2ZvbzogJ2Jhcid9XVxuICAgICAgfSkuc2hvdWxkLmRlZXAuZXF1YWwoe2hlbGxvOiAnd29ybGQnLCBmb286ICdiYXInfSk7XG4gICAgfSk7XG4gIH0pO1xufSk7XG4iXSwic291cmNlUm9vdCI6Ii4uLy4uLy4uIn0=
